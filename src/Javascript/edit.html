<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quote Management - CRUD</title>
  <!-- Bootstrap CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Add custom styles here */
  </style>
</head>
<body>
<div class="container mt-5">
  <h1>Quote Management - CRUD</h1>

  <!-- Form to add a new quote -->
  <div class="card p-4">
    <h2>Add New Quote</h2>
    <form id="quoteForm">
      <div class="form-group">
        <label for="quoteInput">Quote:</label>
        <input type="text" class="form-control" id="quoteInput" placeholder="Enter a quote" required>
      </div>
      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="authorIdInput">Author ID:</label>
          <input type="text" class="form-control" id="authorIdInput" placeholder="Enter author ID" required>
        </div>
        <div class="form-group col-md-6">
          <label for="authorNameInput">Author Name:</label>
          <input type="text" class="form-control" id="authorNameInput" placeholder="Enter author name" required>
        </div>
      </div>
      <button type="submit" class="btn btn-primary">Add Quote</button>
    </form>
  </div>

  <hr>

  <h2>Quotes</h2>
  <table class="table">
    <thead>
    <tr>
      <th>ID</th>
      <th>Quote</th>
      <th>Author</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody id="quoteTableBody">
    <!-- Quote rows will be dynamically added here -->
    </tbody>
  </table>
</div>

<script>
  const apiUrl = 'http://localhost:8080/api/quote'; // Replace with your backend URL

  window.onload = function() {
    const URLQuote = "http://localhost:8080/api/quote";

    // Function to fetch quotes and populate the table
    function fetchAndPopulateQuotes() {
      fetch(URLQuote)
              .then(response => {
                if (!response.ok) {
                  throw new Error('Network response was not ok.');
                }
                return response.json();
              })
              .then(data => {
                makeQuoteRows(data);
              })
              .catch(error => {
                // Handle errors
                console.error('There was a problem with the fetch operation:', error);
              });
    }

    // Function to create table rows for quotes
    function makeQuoteRows(quotes) {
      const tableBody = document.getElementById("quoteTableBody");
      tableBody.innerHTML = ''; // Clear previous rows

      const rows = quotes.map(quote => {
        return `
          <tr>
            <td>${quote.quoteID}</td>
            <td>${quote.quoteText}</td>
            <td>${quote.author ? quote.author.authorName : ''}</td>
          </tr>
        `;
      });

      tableBody.innerHTML = rows.join("");
    }

    // Trigger the fetch and population of quotes when the page loads
    fetchAndPopulateQuotes();
  };

  // Function to add a new quote
  const quoteForm = document.getElementById('quoteForm');
  quoteForm.addEventListener('submit', function(event) {
    event.preventDefault();
    const quoteInput = document.getElementById('quoteInput').value.trim();
    const authorIdInput = document.getElementById('authorIdInput').value.trim();
    const authorNameInput = document.getElementById('authorNameInput').value.trim();

    if (quoteInput !== '' && authorIdInput !== '' && authorNameInput !== '') {
      const newQuote = {
        quoteText: quoteInput,
        author: {
          authorID: parseInt(authorIdInput),
          authorName: authorNameInput
        }
      };

      // Logging the newQuote object
      console.log('New Quote:', newQuote);

      fetch(apiUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(newQuote)
      })
              .then(response => {
                if (!response.ok) {
                  throw new Error('Failed to add quote.');
                }
                fetchAndPopulateQuotes(); // Refresh quotes after adding
              })
              .catch(error => {
                console.error('Error adding quote:', error);
              });
    }
  });

  // Load initial quotes when the page loads

</script>
</body>
</html>
